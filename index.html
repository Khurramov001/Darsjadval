<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Theme Dars Jadvali</title>
    <link rel="stylesheet" href="mobile-styles.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #3498db;
            --background: #1a1a1a;
            --text-color: #ecf0f1;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--background);
            font-family: 'Arial Rounded MT Bold', sans-serif;
            perspective: 1000px;
            padding: 20px;
            color: var(--text-color);
        }

        .random-theme-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: var(--accent);
            border: none;
            border-radius: 25px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .random-theme-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 1200px;
            transform-style: preserve-3d;
        }

        .day-column {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: rotateY(-10deg) scale(0.95);
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .day-column:hover {
            transform: rotateY(0deg) scale(1);
            background: rgba(46, 204, 113, 0.1);
            box-shadow: 0 15px 40px rgba(46, 204, 113, 0.2);
        }

        .time-slot {
            padding: 10px;
            margin: 8px 0;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .time-slot::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--secondary);
            border-radius: 5px;
        }

        .time-slot:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .lesson-title {
            color: var(--accent);
            margin: 5px 0;
            font-size: 0.95em;
        }

        .lesson-details {
            font-size: 0.8em;
            color: var(--text-color);
            line-height: 1.4;
        }

        .day-header {
            text-align: center;
            padding: 10px;
            margin-bottom: 15px;
            background: var(--primary);
            border-radius: 10px;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9em;
            animation: glow 3s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px var(--accent); }
            50% { box-shadow: 0 0 15px var(--accent); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .schedule-grid {
            animation: float 6s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .schedule-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }

            .day-column {
                padding: 10px;
            }

            .lesson-title {
                font-size: 0.85em;
            }

            .lesson-details {
                font-size: 0.75em;
            }
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <button id="notificationBtn" class="random-theme-btn" style="top: 80px;">
        üîî Eslatmalarni Yoqish
    </button>

    <div class="schedule-grid" id="schedule"></div>
    <button class="random-theme-btn" id="randomThemeBtn">Random Theme</button>
    <div class="schedule-grid" id="schedule"></div>

    <script>
        const tg = window.Telegram.WebApp;

        // Asosiy sozlamalar
        tg.expand(); // WebApp to'liq ekranda ko'rsatish
        tg.MainButton.setText("Yopish").show().onClick(() => tg.close());

        // Foydalanuvchi ma'lumotlari
        const user = tg.initDataUnsafe.user;
        if (user) {
            console.log("Foydalanuvchi:", user.first_name);
        }

        const themes = [
            {
                primary: '#2c3e50',
                secondary: '#e74c3c',
                accent: '#3498db',
                background: '#1a1a1a',
                textColor: '#ecf0f1',
                animation: 'float 6s ease-in-out infinite'
            },
            {
                primary: '#34495e',
                secondary: '#9b59b6',
                accent: '#1abc9c',
                background: '#2c3e50',
                textColor: '#ecf0f1',
                animation: 'rotate 6s ease-in-out infinite'
            },
            {
                primary: '#8e44ad',
                secondary: '#f1c40f',
                accent: '#e67e22',
                background: '#2c3e50',
                textColor: '#ecf0f1',
                animation: 'scale 6s ease-in-out infinite'
            },
            {
                primary: '#16a085',
                secondary: '#d35400',
                accent: '#2980b9',
                background: '#1a1a1a',
                textColor: '#ecf0f1',
                animation: 'slide 6s ease-in-out infinite'
            },
            {
                primary: '#c0392b',
                secondary: '#f39c12',
                accent: '#27ae60',
                background: '#2c3e50',
                textColor: '#ecf0f1',
                animation: 'fade 6s ease-in-out infinite'
            }
        ];

        const animations = [
            `@keyframes rotate {
                0%, 100% { transform: rotateY(0deg); }
                50% { transform: rotateY(180deg); }
            }`,
            `@keyframes scale {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }`,
            `@keyframes slide {
                0%, 100% { transform: translateX(0); }
                50% { transform: translateX(20px); }
            }`,
            `@keyframes fade {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }`,
            `@keyframes float {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
            }`
        ];

        function applyRandomTheme() {
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            const randomAnimation = animations[Math.floor(Math.random() * animations.length)];

            document.documentElement.style.setProperty('--primary', randomTheme.primary);
            document.documentElement.style.setProperty('--secondary', randomTheme.secondary);
            document.documentElement.style.setProperty('--accent', randomTheme.accent);
            document.documentElement.style.setProperty('--background', randomTheme.background);
            document.documentElement.style.setProperty('--text-color', randomTheme.textColor);

            const styleSheet = document.createElement('style');
            styleSheet.type = 'text/css';
            styleSheet.innerText = randomAnimation;
            document.head.appendChild(styleSheet);

            const scheduleGrid = document.querySelector('.schedule-grid');
            scheduleGrid.style.animation = randomTheme.animation;
        }

        document.getElementById('randomThemeBtn').addEventListener('click', applyRandomTheme);

        const fullSchedule = {
            "Dushanba 27": [
                {
                    time: "14:20-15:40",
                    subject: "Geometriya",
                    type: "Ma'ruza",
                    instructor: "JURAYEV T. F.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "15:50-17:05",
                    subject: "Matematika o'qitish metodikasi",
                    type: "Ma'ruza",
                    instructor: "SAYDAI≈ÖEVA F. X.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "17:20-18:40",
                    subject: "Matematika o'qitish metodikasi",
                    type: "Amaliy",
                    instructor: "SAYDAI≈ÖEVA F. X.",
                    group: "2-12 Fizika-matematika"
                }
            ],
            "Chorshanba 29": [
                {
                    time: "14:20-15:40",
                    subject: "Algebra va sonlar nazariyasi",
                    type: "Amaliy",
                    instructor: "TURSUNOVA Z. O.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "15:50-17:05",
                    subject: "Funksiyalar nazariyasi",
                    type: "Ma'ruza",
                    instructor: "TURGUNBAYEV R. M.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "17:20-18:40",
                    subject: "Funksiyalar nazariyasi",
                    type: "Amaliy",
                    instructor: "KOSHNAZAROV R. A.",
                    group: "2-12 Fizika-matematika"
                }
            ],
            "Payshanba 30": [
                {
                    time: "14:20-15:40",
                    subject: "Ma'lumotlar bazasi",
                    type: "Ma'ruza",
                    instructor: "TUXTAMATOV X. R.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "15:50-17:05",
                    subject: "Ehtimollar nazariyasi",
                    type: "Ma'ruza",
                    instructor: "YODGAROV S. J.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "17:20-18:40",
                    subject: "Ehtimollar nazariyasi",
                    type: "Amaliy",
                    instructor: "YODGAROV S. J.",
                    group: "2-12 Fizika-matematika"
                }
            ],
            "Shanba 1": [
                {
                    time: "14:00-15:40",
                    subject: "Funksiyalar nazariyasi",
                    type: "Ma'ruza",
                    instructor: "TURGUNBAYEV R. M.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "16:00-17:20",
                    subject: "Algebra va sonlar nazariyasi",
                    type: "Ma'ruza",
                    instructor: "MUXAMEDOVA G. R.",
                    group: "2-12 Fizika-matematika"
                },
                {
                    time: "17:20-18:40",
                    subject: "Geometriya",
                    type: "Amaliy",
                    instructor: "MANASIPOVA R. Z.",
                    group: "2-12 Fizika-matematika"
                }
            ]
        };

        function createSchedule() {
            const container = document.getElementById('schedule');
            
            for(const [day, lessons] of Object.entries(fullSchedule)) {
                const column = document.createElement('div');
                column.className = 'day-column';
                
                let content = `<div class="day-header">${day}</div>`;
                lessons.forEach(lesson => {
                    content += `
                        <div class="time-slot">
                            <div class="lesson-title">${lesson.subject}</div>
                            <div class="lesson-details">
                                <p>üïí ${lesson.time}</p>
                                <p>üéì ${lesson.instructor}</p>
                                <p>üìö ${lesson.type}</p>
                                <p>üë• ${lesson.group}</p>
                            </div>
                        </div>
                    `;
                });
                
                column.innerHTML = content;
                container.appendChild(column);
            }
        }

        createSchedule();
         const BOT_TOKEN = '7291198987:AAFJiJ1nxyO0MXjw4dMUjGGeIjul_EX1exk'; // BotFather tokenini qo'ying!
            let USER_CHAT_ID = null;

            // Eslatma yuborish funksiyasi
            async function sendReminder(lesson) {
                const reminderText = `‚è∞ Diqqat! 15 daqiqadan keyin dars:\nüìö ${lesson.subject}\nüïí ${lesson.time}\nüéì ${lesson.instructor}`;

                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: USER_CHAT_ID,
                            text: reminderText
                        })
                    });
                } catch (error) {
                    console.error('Xatolik:', error);
                }
            }

            // Vaqtni hisoblash funksiyasi
            function calculateReminderTime(dayString, timeString) {
                const [_, day] = dayString.split(' '); // "Dushanba 27" -> 27
                const [startTime] = timeString.split('-');
                const [hours, minutes] = startTime.split(':');

                const date = new Date();
                date.setDate(parseInt(day));
                date.setHours(hours, minutes - 15, 0, 0); // 15 daqiqa oldin

                return date.getTime();
            }

            // Eslatmalarni sozlash
            function setupReminders() {
                Object.entries(fullSchedule).forEach(([day, lessons]) => {
                    lessons.forEach(lesson => {
                        const reminderTime = calculateReminderTime(day, lesson.time);
                        if(reminderTime > Date.now()) {
                            setTimeout(() => sendReminder(lesson), reminderTime - Date.now());
                        }
                    });
                });
            }

            // Tugma bosilganda ishga tushirish
            document.getElementById('notificationBtn').addEventListener('click', () => {
                USER_CHAT_ID = Telegram.WebApp.initDataUnsafe.user?.id;
                if(USER_CHAT_ID) {
                    setupReminders();
                    Telegram.WebApp.showAlert('üîî Eslatmalar yoqildi!');
                } else {
                    Telegram.WebApp.showAlert('‚ö†Ô∏è Iltimos, avval botga kirish amalga oshiring!');
                }
            });
        </script>
</body>
</html>